{% load static %}
<!DOCTYPE html>
<html lang="en">

    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Tire-Information</title>
      <link rel="icon" href="{% static 'images/logo_tab.png' %}" type="image/x-icon">
      <link rel="stylesheet" href="{% static 'css/bootstrap.css' %}" type="text/css">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
      <style>
        .top_section{
          width: 100%;
          height:100%;
          min-height: 100px;
          border: 1px solid black;
          background-color: black;
          color: white;
        }
        .bottom_section_left{
          width: 15%;
          height:85vh;
          min-width: 150px;
          border: 1px solid black;
        }
        .bottom_section_right{
          width: 100%;
          height:85vh;
          border: 1px solid black;
        }
        .custom-btn {
          background-color: rgb(0, 0, 0);   /* é»˜è®¤èƒŒæ™¯ä¸ºç™½è‰² */
          color: rgb(255, 255, 255);              /* é»˜è®¤æ–‡å­—é¢œè‰²ä¸ºé»‘è‰² */
          border-color: rgb(255, 255, 255);       /* é»˜è®¤è¾¹æ¡†ä¸ºé»‘è‰² */
        }

        .custom-btn:hover {
          background-color: rgb(255, 255, 255);   /* æ‚¬åœæ—¶èƒŒæ™¯å˜ä¸ºé»‘è‰² */
          color: rgb(0, 0, 0);              /* æ‚¬åœæ—¶æ–‡å­—å˜ä¸ºç™½è‰² */
          border-color: rgb(0, 0, 0);       /* æ‚¬åœæ—¶ä¿æŒé»‘è‰²è¾¹æ¡† */
        }
      </style>
    </head>

    <body>
        <div class="container-fluid">
          <!-- ä¸ŠåŠéƒ¨åˆ†ï¼Œæ¨ªè·¨æ•´ä¸ªé¡µé¢å®½åº¦ -->
          <div class="row">
            <div class="col top_section w-100 d-flex align-items-center">
              <!-- Profile Image -->
              <img src="{% static 'images/profileimg.jpg' %}" alt="Profile Image" class="rounded-circle" style="margin-left: 5vw;" width="100vw" height="100vw">
              
              <!-- User Info -->
              <div style="margin-left: 2vw; margin-top: 2vh;">
                <h1 style="font-size: 1.5vw; ">{{ user.username }} [UID:{{user.id}}]</h1>
                <p style="font-size: 1.2vw;">{{ user.email }}</p>
              </div>
              
              <!-- Balance and Log Out button -->
              <div class="d-flex align-items-center" style="margin-left: auto;">
                <h1 style="font-size: 1.5vw;">Balance:</h1>
                <h4 style="margin-right: 10vw; font-size: 1.2vw;"><strong>&pound;{{ user.balance }}</strong></h4>
                <div class="input-group" style="width: 250px;margin-right: 5vw;">
                  <span class="input-group-text"><strong>&pound;</strong></span>
                  <input type="number" id="rechageInput" step="0.01" class="form-control" aria-label="Dollar amount (with dot and two decimal places)">
                  <button tyep="button" onclick="recharge()" class="btn btn-outline-light">Recharge</button>
                </div>
                <button style="margin-right: 10vw; height:auto; font-size: 1.2vw;" type="button" class="btn btn-outline-danger btn-lg">Log Out</button>
              </div>
            </div>
          </div>
        
          <!-- ä¸‹åŠéƒ¨åˆ†ï¼Œåˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ† -->
          <div class="row">
            <!-- å·¦è¾¹éƒ¨åˆ† -->
            <div class="col-md-6 bottom_section_left text-center" style="font-size: 21px;min-width: 250px;">
              <nav class="nav flex-column" style="margin-top: 200px;">
                <!-- ä½¿ç”¨ flex ç±»æ¥ç¡®ä¿æŒ‰é’®æ°´å¹³å±…ä¸­ -->
                <a href="{% url 'payment' %}" type="button" class="btn btn-outline-dark mt=5 custom-btn" style="font-size: 26px; width: 150px; margin-left: auto; margin-right: auto;"><strong>Payment</strong></a> 
                <a href="{% url 'history' %}" class="btn btn-outline-dark mt-5 custom-btn" style="font-size: 26px; width: 150px; margin-left: auto; margin-right: auto;"><strong>History</strong></a>
                <a href="{% url 'inprogress' %}" class="btn btn-outline-dark mt-5 custom-btn" style="font-size: 26px; width: 150px; margin-left: auto; margin-right: auto;"><strong>Back</strong></a>
                <img src="{% static 'images/tire_logo_black.png' %}" alt="Brand Image" 
                     style="margin-top: 15vh; display: block; margin-left: auto; margin-right: auto; width: 200px; height: auto;">
              </nav>
            </div>
            
            <!-- å³è¾¹éƒ¨åˆ† -->
            <div class="col bottom_section_right text-black p-4" id="contentArea" style="background-color: rgba(119, 119, 119, 0.438);">
              <div style="display: flex; justify-content: center; align-items: center; ">
                <h1 style="margin-right: 60px;">History</h1>
                <div class="input-group" style="width: 300px;">
                  <span class="input-group-text" id="basic-addon1">ğŸ§</span>
                  <input id="searchInput" type="text" class="form-control" placeholder="Find a Invoice(â‰§â—¡â‰¦)" aria-label="Username" aria-describedby="basic-addon1">
                </div>
              </div>
            <div class="overflow-auto" style="height: 95%;; width: 100%"> <!-- è®¾ç½®æœ€å¤§é«˜åº¦ -->
              <div class="row">
                <div class="row row-cols-1 row-cols-md-1">
                  {% for obj in invoiceset %}
                  <div class="col">
                      <div class="card shadow-lg" style="height: 200px;background-color: rgba(102, 139, 0, 0.226); backdrop-filter: blur(10px);border: none;box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
                          <div class="card-body">
                              <h5 class="card-title position-absolute" style="bottom: 10px; left: 80px; font-size: 16px;">Invoice ID: {{ obj.invoice_id }}</h5>
                              <p class="card-text position-absolute" style="top: 30px; left: 80px;font-size: 30px;"><strong>{{ obj.user.username }}</strong></p>
                              <p class="card-num position-absolute" style="top: 40px; right: 80px;font-size: 36px;"><strong>&pound;{{ obj.amount }}</strong></p>
                              <p class="card-createdate position-absolute" style="bottom: 70px; left: 80px;font-size: 18px;">Created at: {{ obj.created_at }}</p>
                              <p class="card-paiddate position-absolute" style="bottom: 32px; left: 80px;font-size: 18px;">Paid at: {{ obj.paid_at }}</p>
                              <a href="{% url 'historyDetail' invoice_id=obj.invoice_id %}" class="btn btn-outline-dark position-absolute" style="bottom: 30px; right: 80px;">View Details</a>
                          </div>
                      </div>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>  
              
            </div>
          </div>
        </div>
      
      <script>

        function recharge(){
          const amount = document.getElementById('rechageInput').valueAsNumber;
          if (!isNaN(amount)){
            fetch(`recharge/?amount=${amount}`)
            .then(response => {
                if (response.ok) {
                    console.log("å……å€¼æˆåŠŸï¼");
                    window.location.reload();
                } else {
                    console.error('æ“ä½œå¤±è´¥:', response.status);  // å¤„ç†é”™è¯¯
                }
            })
            .catch(error => {
                console.error('è¯·æ±‚å¤±è´¥:', error);  // å¤„ç†ç½‘ç»œé”™è¯¯
                
            });
          }
          else{
            console.log("æ²¡æœ‰è¾“å…¥å……å€¼é‡‘é¢");
          }
        }
        // ç›‘å¬è¾“å…¥æ¡†å†…å®¹å˜åŒ–
        document.getElementById('searchInput').addEventListener('input', function() {
          var searchTerm = String(searchInput.value.toLowerCase());  // è·å–è¾“å…¥çš„æœç´¢è¯å¹¶è½¬ä¸ºå°å†™
          document.querySelectorAll('.card').forEach(function(card) {
            // è·å–æ¯ä¸ªå¡ç‰‡çš„æ–‡æœ¬å†…å®¹
            var keyword1 = String(card.querySelector('.card-title').textContent.toLowerCase());
            var keyword2 = String(card.querySelector('.card-num').textContent.toLowerCase());
            var keyword3 = String(card.querySelector('.card-createdate').textContent.toLowerCase());
            var keyword4 = String(card.querySelector('.card-paiddate').textContent.toLowerCase());

            // å¦‚æœä»»ä½•ä¸€ä¸ªå­—æ®µåŒ…å«æœç´¢è¯ï¼Œåˆ™æ˜¾ç¤ºè¯¥å¡ç‰‡ï¼Œå¦åˆ™éšè—
            if (keyword1.includes(searchTerm) || keyword2.includes(searchTerm) || keyword3.includes(searchTerm) || keyword4.includes(searchTerm)) {
              card.style.display = '';  // æ˜¾ç¤ºå¡ç‰‡
            } else {
              card.style.display = 'none';  // éšè—å¡ç‰‡
            }
          });
        });

      </script>
        
      <!-- jQuery and JavaScript Bundle with Popper è¿™é‡Œå¼•å…¥çš„æ˜¯æœ¬åœ°jsæ–‡ä»¶-->
      <script src="{% static 'js/bootstrap.bundle.min.js' %}" crossorigin="anonymous"></script>

    </body>
</html>